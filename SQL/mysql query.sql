	--TBL_VOTE_202005
	V_JUMIN
	V_NAME
	v_NO
	v_TIME
	v_AREA
	v_CONFIRM
	
	--TBL_MEMBER_202005
	M_NO
	M_NAME
	P_CODE
	P_SCHOOL
	M_JUMIN
	M_CITY
	
	--TBL_PARTY_202005
	P_CODE
	P_NAME
	P_INDATE
	P_READER
	P_TEL1
	P_TEL2
	P_TEL3

CREATE table TBL_VOTE_202005(
	V_JUMIN CHAR(13) PRIMARY KEY,
	V_NAME VARCHAR(20),
	v_NO CHAR(1),
	v_TIME CHAR(4),
	v_AREA CHAR(20),
	v_CONFIRM CHAR(1)
);
CREATE table TBL_MEMBER_202005(
	M_NO CHAR(1) PRIMARY KEY,
	M_NAME VARCHAR(20),
	P_CODE CHAR(2),
	P_SCHOOL CHAR(1),
	M_JUMIN CHAR(13),
	M_CITY VARCHAR(20)
);
CREATE table TBL_PARTY_202005(
	P_CODE CHAR(2) PRIMARY KEY,
	P_NAME VARCHAR(20),
	P_INDATE DATE,
	P_READER VARCHAR(20),
	P_TEL1 CHAR(3),
	P_TEL2 CHAR(4),
	P_TEL3 CHAR(4)
);

INSERT INTO TBL_MEMBER_202005 VALUES('1','김후보','P1','1','6603011999991','수선화동');
INSERT INTO TBL_MEMBER_202005 VALUES('2','이후보','P2','3','5503011999992','민들레동');
INSERT INTO TBL_MEMBER_202005 VALUES('3','박후보','P3','2','7703011999993','나팔꽃동');
INSERT INTO TBL_MEMBER_202005 VALUES('4','조후보','P4','2','8803011999994','진달래동');
INSERT INTO TBL_MEMBER_202005 VALUES('5','최후보','P5','3','9903011999995','개나리동');

INSERT INTO TBL_PARTY_202005 VALUES('P1','A정당','2010-01-01','위대표','02','1111','0001');
INSERT INTO TBL_PARTY_202005 VALUES('P2','B정당','2010-02-01','명대표','02','1111','0002');
INSERT INTO TBL_PARTY_202005 VALUES('P3','C정당','2010-03-01','기대표','02','1111','0003');
INSERT INTO TBL_PARTY_202005 VALUES('P4','D정당','2010-04-01','옥대표','02','1111','0004');
INSERT INTO TBL_PARTY_202005 VALUES('P5','E정당','2010-05-01','임대표','02','1111','0005');
--mysql은 문자열 그대로 넣어도 값 입력이 된다

--MemberDTO
SELECT m.M_NO, m.M_NAME, p.P_name, 
       CASE m.P_SCHOOL 
           WHEN '1' THEN '고졸' 
           WHEN '2' THEN '학사' 
           WHEN '3' THEN '석사'  
           WHEN '4' THEN '박사' 
       END AS p_school, 
       CONCAT(SUBSTR(m.M_JUMIN, 1, 6), '-', SUBSTR(m.M_JUMIN, 7, 14)) AS m_jumin, 
       m.M_CITY, CONCAT(TRIM(p.P_TEL1), '-', p.P_TEL2, '-', p.P_TEL3) AS TEL 
FROM TBL_MEMBER_202005 m 
JOIN TBL_PARTY_202005 p ON m.p_code = p.p_code;

--VoteDTO
SELECT V_NAME,
CONCAT(
    CASE WHEN SUBSTR(V_JUMIN, 7, 1) IN ('1','2') THEN CONCAT('19', SUBSTR(V_JUMIN, 1, 2))
         WHEN SUBSTR(V_JUMIN, 7, 1) IN ('3','4') THEN CONCAT('20', SUBSTR(V_JUMIN, 1, 2)) END,
	 '년 ', SUBSTR(V_JUMIN, 3, 2), '월', SUBSTR(V_JUMIN, 5, 2), '일생' ) AS birth,
CONCAT('만 ', YEAR(NOW())-CONCAT('19', SUBSTR(V_JUMIN, 1, 2)), '살') AS age,
CASE WHEN SUBSTR(V_JUMIN, 7, 1) IN ('1','3') THEN '남자'
     WHEN SUBSTR(V_JUMIN, 7, 1) IN ('2','4') THEN '여자' END AS gender,
V_NO,
CONCAT(SUBSTR(V_TIME, 1, 2), ':', SUBSTR(V_TIME, 3, 2)) AS time,
CASE V_CONFIRM WHEN 'Y' THEN '확인'
               WHEN 'N' THEN '미확인' END AS confirm
FROM TBL_VOTE_202005
WHERE V_AREA = '제1투표장';

--RankDTO
SELECT m.M_NO, m.M_NAME, COUNT(v.v_NO) AS tot
FROM TBL_MEMBER_202005 m
JOIN TBL_VOTE_202005 v ON m.M_NO = v.V_NO
WHERE v.V_CONFIRM != 'N'
GROUP BY m.M_NO, m.M_NAME
ORDER BY tot DESC;
